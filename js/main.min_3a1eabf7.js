var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))(function(r,n){function o(t){try{h(a.next(t))}catch(e){n(e)}}function s(t){try{h(a["throw"](t))}catch(e){n(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,s)}h((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BlockGraphics=function(t){function e(){var e=t.call(this)||this;return e.colorArr=["0x000000","0xffffff","0xcccccc","0xff0000"],e._canTouch=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){this.touchEnabled=!0,this.width=GameData.getBlockWidth(),this.height=GameData.getBlockHeight(),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.blockClick,this)},e.prototype.drawBlock=function(t){void 0===t&&(t=!1),this._canTouch=t,this.graphics.clear(),t?this.graphics.beginFill(this.colorArr[0]):this.graphics.beginFill(this.colorArr[1]),this.graphics.lineStyle(1,0),this.graphics.drawRect(0,0,GameData.getBlockWidth(),GameData.getBlockHeight()),this.graphics.endFill()},e.prototype.blockClick=function(t){this.graphics.clear(),this._canTouch?this.graphics.beginFill(this.colorArr[2]):this.graphics.beginFill(this.colorArr[3]),this.graphics.lineStyle(1,0),this.graphics.drawRect(0,0,GameData.getBlockWidth(),GameData.getBlockHeight()),this.graphics.endFill();var e;e=new GameEvent(this._canTouch?GameEvent.GAME_HIT:GameEvent.GAME_OVER),this.dispatchEvent(e)},e}(egret.Shape);__reflect(BlockGraphics.prototype,"BlockGraphics");var BlockGroup=function(t){function e(){var e=t.call(this)||this;return e._isTouch=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){this._boxArr=[];for(var t=0;t<GameData.column;t++){var e=new BlockGraphics;this._boxArr.push(e),e.addEventListener(GameEvent.GAME_HIT,this.gameHit,this),e.addEventListener(GameEvent.GAME_OVER,this.gameOver,this),this.addChild(e),e.x=GameData.getBlockWidth()*t}},e.prototype.createOne=function(){this._isTouch=!1;for(var t=Math.floor(4*Math.random()),e=this._boxArr.length,i=0;e>i;i++)i===t?this._boxArr[i].drawBlock(!0):this._boxArr[i].drawBlock(!1)},e.prototype.gameHit=function(t){if(!this._isTouch){this._isTouch=!0;var e=new GameEvent(GameEvent.GAME_HIT);this.dispatchEvent(e)}},e.prototype.gameOver=function(t){var e=new GameEvent(GameEvent.GAME_OVER);this.dispatchEvent(e)},e}(egret.Sprite);__reflect(BlockGroup.prototype,"BlockGroup");var GameData=function(){function t(){t.row=t.getStageWidth()/t.getBlockWidth()}return t.setScore=function(e){t.score=e},t.getScore=function(){return t.score},t.getBlockWidth=function(){return 0===t.blockWidth&&(t.blockWidth=egret.MainContext.instance.stage.stageWidth/t.column),t.blockWidth},t.getBlockHeight=function(){return 0===t.blockHeight&&(t.blockHeight=egret.MainContext.instance.stage.stageHeight/t.row),t.blockHeight},t.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},t.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},t.score=0,t.row=5,t.column=4,t.speed=10,t.blockWidth=0,t.blockHeight=0,t}();__reflect(GameData.prototype,"GameData");var GameEvent=function(t){function e(e,i,a){return void 0===i&&(i=!1),void 0===a&&(a=!1),t.call(this,e,i,a)||this}return __extends(e,t),e.GAME_OVER="game_over",e.GAME_HIT="game_hit",e.GAME_START="game_start",e}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var GameOverPanel=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this._bg=new egret.Shape,this._bg.graphics.beginFill(0),this._bg.graphics.drawRect(0,0,GameData.getStageWidth(),GameData.getStageHeight()),this._bg.graphics.endFill(),this.addChild(this._bg),this._score=new egret.TextField,this._score.textColor=16711680,this._score.bold=!0,this._score.text="SCORE:"+String(GameData.getScore()),this._score.size=100,this._score.x=(GameData.getStageWidth()-this._score.width)/2,this._score.y=50,this.addChild(this._score),this._tryagainBtn=new egret.TextField,this._tryagainBtn.text="TRY AGAIN",this._tryagainBtn.size=90,this._tryagainBtn.x=(GameData.getStageWidth()-this._tryagainBtn.width)/2,this._tryagainBtn.y=(GameData.getStageHeight()-this._tryagainBtn.height)/2,this.addChild(this._tryagainBtn),this._tryagainBtn.touchEnabled=!0,this._tryagainBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tryagainFunc,this)},e.prototype.updateScore=function(){this._score.text="SCORE:"+String(GameData.getScore())},e.prototype.tryagainFunc=function(){var t=new GameEvent(GameEvent.GAME_START);this.dispatchEvent(t)},e}(egret.Sprite);__reflect(GameOverPanel.prototype,"GameOverPanel");var GameView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this._blockGroup=[];for(var t=GameData.row+1,e=0;t>e;e++){var i=new BlockGroup;this._blockGroup.push(i),this.addChild(i),i.addEventListener(GameEvent.GAME_OVER,this.gameOver,this),i.addEventListener(GameEvent.GAME_HIT,this.gamehit,this)}this.scoreText=new egret.TextField,this.scoreText.textColor=16711680,this.scoreText.bold=!0,this.scoreText.text=String(GameData.getScore()),this.scoreText.size=100,this.scoreText.x=(GameData.getStageWidth()-this.scoreText.width)/2,this.scoreText.y=50,this.addChild(this.scoreText)},e.prototype.gamestart=function(){this.scoreText.text=String(GameData.getScore());for(var t=GameData.row+1,e=0;t>e;e++)this._blockGroup[e].createOne(),this._blockGroup[e].y=GameData.getBlockHeight()*e},e.prototype.move=function(){for(var t=GameData.row+1,e=0;t>e;e++)this._blockGroup[e].y+=GameData.getBlockHeight(),this._blockGroup[e].y>GameData.getStageHeight()&&(this._blockGroup[e].y=0,this._blockGroup[e].createOne())},e.prototype.gameOver=function(t){void 0===t&&(t=null);var e=new GameEvent(GameEvent.GAME_OVER);this.dispatchEvent(e)},e.prototype.gamehit=function(t){this.move(),GameData.setScore(GameData.getScore()+1),this.scoreText.text=String(GameData.getScore())},e}(egret.Sprite);__reflect(GameView.prototype,"GameView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadResource(),this.init()},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.init=function(){this.gv=new GameView,this.addChild(this.gv),this.gv.addEventListener(GameEvent.GAME_OVER,this.gameover,this),this.gameStartPanel=new StartGamePanel,this.gameStartPanel.addEventListener(GameEvent.GAME_START,this.gamebegin,this),this.addChild(this.gameStartPanel),this.gameOverPanel=new GameOverPanel,this.gameOverPanel.addEventListener(GameEvent.GAME_START,this.gamebegin,this)},e.prototype.gameover=function(){this.gameOverPanel.updateScore(),this.addChild(this.gameOverPanel)},e.prototype.gamebegin=function(){GameData.setScore(0),this.gv.gamestart(),this.gameStartPanel.parent?this.removeChild(this.gameStartPanel):this.gameOverPanel.parent&&this.removeChild(this.gameOverPanel)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var StartGamePanel=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this._bg=new egret.Shape,this._bg.graphics.beginFill(0),this._bg.graphics.drawRect(0,0,GameData.getStageWidth(),GameData.getStageHeight()),this._bg.graphics.endFill(),this.addChild(this._bg),this._gameTitle=new egret.TextField,this._gameTitle.text="Piano Tiles",this._gameTitle.size=120,this._gameTitle.textColor=16777215,this._gameTitle.x=(GameData.getStageWidth()-this._gameTitle.width)/2,this._gameTitle.y=200,this.addChild(this._gameTitle),this._startBtn=new egret.TextField,this._startBtn.text="START",this._startBtn.textColor=16711680,this._startBtn.size=100,this._startBtn.x=(GameData.getStageWidth()-this._startBtn.width)/2,this._startBtn.y=(GameData.getStageHeight()-this._startBtn.height)/2,this.addChild(this._startBtn),this._startBtn.touchEnabled=!0,this._startBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.click,this)},e.prototype.click=function(t){var e=new GameEvent(GameEvent.GAME_START);this.dispatchEvent(e)},e}(egret.Sprite);__reflect(StartGamePanel.prototype,"StartGamePanel");